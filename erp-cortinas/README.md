# üè¢ ERP Cortinas Aymara

Sistema de gesti√≥n empresarial (ERP) especializado para empresas de cortinas met√°licas, desarrollado con tecnolog√≠as modernas y arquitectura escalable.

## üìã Tabla de Contenidos

- [Caracter√≠sticas](#-caracter√≠sticas)
- [Tecnolog√≠as](#-tecnolog√≠as)
- [Arquitectura](#-arquitectura)
- [Base de Datos](#-base-de-datos)
- [Instalaci√≥n](#-instalaci√≥n)
- [Configuraci√≥n](#-configuraci√≥n)
- [Uso](#-uso)
- [API Endpoints](#-api-endpoints)
- [M√≥dulos del Sistema](#-m√≥dulos-del-sistema)
- [Estructura del Proyecto](#-estructura-del-proyecto)
- [Desarrollo](#-desarrollo)
- [Despliegue](#-despliegue)
- [Seguridad](#-seguridad)
- [Contribuci√≥n](#-contribuci√≥n)

## ‚ú® Caracter√≠sticas

### üéØ M√≥dulos Principales Implementados

- **üë• Gesti√≥n de Clientes**: CRUD completo con datos de contacto y direcci√≥n
- **üìã Presupuestos**: Sistema de cotizaciones con items detallados vinculado a clientes
- **üí∞ M√≥dulo de Ventas**: Registro de ventas con items y vinculaci√≥n a presupuestos
- **üìÑ Generaci√≥n de PDFs**: Sistema completo de generaci√≥n de presupuestos en PDF con Puppeteer
- **‚öôÔ∏è Configuraci√≥n Empresarial**: Gesti√≥n de configuraci√≥n SMTP y WhatsApp con cifrado AES-256-GCM
- **üîê Sistema de Cifrado**: Protecci√≥n de datos sensibles con claves criptogr√°ficas

### üöÄ Caracter√≠sticas T√©cnicas

- **Interfaz Moderna**: React 18 con CSS Modules y dise√±o responsive
- **API RESTful**: Backend robusto con Node.js, Express y ES Modules
- **Base de Datos**: SQLite con Prisma ORM (configurable para PostgreSQL)
- **Generaci√≥n de PDFs**: Puppeteer para documentos profesionales
- **Cifrado de Datos**: AES-256-GCM para informaci√≥n sensible
- **Dockerizado**: Configuraci√≥n completa con Docker Compose
- **Arquitectura Modular**: Separaci√≥n clara de responsabilidades

## üõ† Tecnolog√≠as

### Frontend
- **React 18.2.0** - Biblioteca de interfaz de usuario
- **React Router DOM 6.14.0** - Enrutamiento del lado del cliente
- **Axios 1.4.0** - Cliente HTTP para APIs
- **CSS Modules** - Estilos modulares y encapsulados
- **Vite 4.4.5** - Herramienta de construcci√≥n r√°pida

### Backend
- **Node.js 18+** - Entorno de ejecuci√≥n con ES Modules
- **Express.js 4.18.2** - Framework web minimalista
- **Prisma 5.0.0** - ORM moderno para bases de datos
- **SQLite/PostgreSQL** - Base de datos (configurable)
- **Puppeteer 24.16.1** - Generaci√≥n de PDFs
- **Bcrypt 6.0.0** - Hash de contrase√±as
- **Nodemailer 7.0.5** - Env√≠o de emails
- **Handlebars 4.7.8** - Templates para PDFs
- **CORS 2.8.5** - Middleware para recursos de origen cruzado

### DevOps
- **Docker & Docker Compose** - Contenedorizaci√≥n
- **Nodemon 2.0.22** - Recarga autom√°tica en desarrollo
- **PostgreSQL 16** - Base de datos en producci√≥n

## üèó Arquitectura

```
erp-cortinas/
‚îú‚îÄ‚îÄ frontend/                    # Aplicaci√≥n React
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/         # Componentes reutilizables
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Navbar.jsx      # Navegaci√≥n principal
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TablaVentas.jsx # Tabla de ventas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FormularioPresupuesto.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BotonAprobarPresupuesto.jsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/              # P√°ginas principales
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Home.jsx        # Dashboard principal
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Clientes.jsx    # Gesti√≥n de clientes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Presupuestos.jsx # Gesti√≥n de presupuestos
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Ventas.jsx      # Gesti√≥n de ventas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/              # Custom hooks
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useVentasFromPresupuestos.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ styles/             # CSS Modules
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.jsx            # Punto de entrada
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile              # Imagen Docker del frontend
‚îÇ   ‚îî‚îÄ‚îÄ package.json            # Dependencias del frontend
‚îú‚îÄ‚îÄ backend/                     # API Node.js
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ modules/            # M√≥dulos de negocio
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clientes/       # Gesti√≥n de clientes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ presupuestos/   # Gesti√≥n de presupuestos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ventas/         # Gesti√≥n de ventas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pdf/            # Generaci√≥n de PDFs
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ configuracion/  # Configuraci√≥n empresarial
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/             # Configuraciones
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db.js           # Conexi√≥n a base de datos
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ encryption.js   # Sistema de cifrado
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/         # Middlewares
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.js         # Autenticaci√≥n
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.js           # Servidor principal
‚îÇ   ‚îú‚îÄ‚îÄ prisma/                 # Esquemas y migraciones
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma       # Modelo de datos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations/         # Migraciones de BD
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ seed.js             # Datos de prueba
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dev.db              # Base de datos SQLite
‚îÇ   ‚îú‚îÄ‚îÄ public/pdfs/            # PDFs generados
‚îÇ   ‚îú‚îÄ‚îÄ templates/              # Templates para PDFs
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile              # Imagen Docker del backend
‚îÇ   ‚îú‚îÄ‚îÄ .env                    # Variables de entorno
‚îÇ   ‚îî‚îÄ‚îÄ package.json            # Dependencias del backend
‚îî‚îÄ‚îÄ docker-compose.yml          # Orquestaci√≥n de servicios
```

## üóÑ Base de Datos

### Modelo de Datos (Prisma Schema)

#### Cliente
```prisma
model Cliente {
  id           Int      @id @default(autoincrement())
  nombre       String
  email        String?
  telefono     String?
  calle        String?
  numero       String?
  ciudad       String?
  provincia    String?
  codigoPostal String?
  createdAt    DateTime @default(now())
  ventas       Venta[]
  presupuestos Presupuesto[]
}
```

#### Presupuesto
```prisma
model Presupuesto {
  id          Int               @id @default(autoincrement())
  descripcion String
  valor       Float
  fecha       DateTime          @default(now())
  estado      String            @default("pendiente")
  clienteId   Int
  cliente     Cliente           @relation(fields: [clienteId], references: [id])
  items       PresupuestoItem[]
  ventas      Venta[]
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
}
```

#### Venta
```prisma
model Venta {
  id            Int           @id @default(autoincrement())
  fecha         DateTime      @default(now())
  total         Float
  estado        String        @default("pendiente")
  observaciones String?
  clienteId     Int
  cliente       Cliente       @relation(fields: [clienteId], references: [id])
  presupuestoId Int?
  presupuesto   Presupuesto?  @relation(fields: [presupuestoId], references: [id])
  items         VentaItem[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}
```

#### Configuraci√≥n Empresarial (con Cifrado)
```prisma
model ConfiguracionEmpresa {
  id        String   @id @default("default")
  
  // Campos no sensibles
  fromName  String?
  fromEmail String?
  host      String?
  port      Int?
  secureTLS Boolean?
  replyTo   String?
  wabaId    String?
  
  // Campos cifrados con AES-256-GCM
  smtpUsername_enc         String?
  smtpPassword_enc         String?
  whatsappPhoneNumberId_enc String?
  whatsappToken_enc        String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

### Relaciones
- **Cliente** ‚Üí **Presupuestos** (1:N)
- **Cliente** ‚Üí **Ventas** (1:N)
- **Presupuesto** ‚Üí **PresupuestoItems** (1:N)
- **Presupuesto** ‚Üí **Ventas** (1:N) - Una venta puede originarse de un presupuesto
- **Venta** ‚Üí **VentaItems** (1:N)

## üì¶ Instalaci√≥n

### Prerrequisitos

- **Node.js** >= 18.0.0
- **npm** >= 9.0.0
- **Docker** y **Docker Compose** (opcional)
- **PostgreSQL** (para producci√≥n)

### üöÄ Instalaci√≥n R√°pida con Docker

```bash
# Clonar el repositorio
git clone https://github.com/LeanRamirez/ERP-Cortinas-Aymara.git
cd erp-cortinas

# Levantar todos los servicios (PostgreSQL + Backend + Frontend)
docker-compose up --build

# Acceder a:
# Frontend: http://localhost:3002
# Backend: http://localhost:4000
# PostgreSQL: localhost:5433
```

### üîß Instalaci√≥n Manual (Desarrollo)

#### 1. Clonar el Repositorio
```bash
git clone https://github.com/LeanRamirez/ERP-Cortinas-Aymara.git
cd erp-cortinas
```

#### 2. Configurar Backend
```bash
cd backend

# Instalar dependencias
npm install

# Configurar variables de entorno
cp .env.example .env
# Editar .env con tus configuraciones

# Generar cliente de Prisma
npx prisma generate

# Ejecutar migraciones
npx prisma migrate dev

# Poblar base de datos (opcional)
npm run seed

# Iniciar servidor de desarrollo
npm run dev  # Con nodemon
# o
npm start    # Producci√≥n
```

#### 3. Configurar Frontend
```bash
cd ../frontend

# Instalar dependencias
npm install

# Iniciar servidor de desarrollo
npm run dev
```

## ‚öôÔ∏è Configuraci√≥n

### Variables de Entorno (Backend)

Crear archivo `.env` en la carpeta `backend/`:

```env
# Base de datos
DATABASE_URL="file:./dev.db"  # SQLite para desarrollo
# DATABASE_URL="postgresql://admin:admin@localhost:5433/erp_cortinas"  # PostgreSQL

# Servidor
PORT=4000
NODE_ENV=development

# Claves de cifrado (generar con script incluido)
CONFIG_SECRETS_KEY=tu_clave_base64_32_bytes
ADMIN_KEY=tu_clave_hex_64_caracteres

# CORS (opcional)
FRONTEND_URL=http://localhost:3000
```

### Generaci√≥n de Claves Criptogr√°ficas

El sistema incluye un script para generar claves seguras:

```bash
# Ejecutar desde la ra√≠z del proyecto
python3 generate-keys.py

# Copiar las claves generadas al archivo .env
```

### Configuraci√≥n de Vite (Frontend)

El archivo `vite.config.js` est√° configurado para:
- Proxy hacia el backend en desarrollo
- Puerto 3000 por defecto
- Hot Module Replacement (HMR)

### Configuraci√≥n Docker

#### Desarrollo
```yaml
# docker-compose.yml
services:
  postgres:
    image: postgres:16
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: admin
      POSTGRES_DB: erp_cortinas
    ports:
      - "5433:5432"

  backend:
    build: ./backend
    ports:
      - "4000:4000"
    environment:
      DATABASE_URL: postgres://admin:admin@postgres:5432/erp_cortinas

  frontend:
    build: ./frontend
    ports:
      - "3002:3000"
```

## üöÄ Uso

### Acceso a la Aplicaci√≥n

#### Desarrollo Local
- **Frontend**: http://localhost:3000
- **Backend API**: http://localhost:4000

#### Con Docker
- **Frontend**: http://localhost:3002
- **Backend API**: http://localhost:4000
- **PostgreSQL**: localhost:5433

### Navegaci√≥n Principal

1. **Dashboard (Home)**: Vista general con m√©tricas y accesos r√°pidos
2. **Clientes**: Gesti√≥n completa de clientes con formularios
3. **Presupuestos**: Creaci√≥n y gesti√≥n de cotizaciones
4. **Ventas**: Registro y seguimiento de ventas
5. **Configuraci√≥n**: Ajustes de empresa y comunicaciones

### Flujo de Trabajo T√≠pico

1. **Registrar Cliente** ‚Üí Crear nuevo cliente con datos completos
2. **Crear Presupuesto** ‚Üí Generar cotizaci√≥n para el cliente
3. **Generar PDF** ‚Üí Crear documento profesional del presupuesto
4. **Aprobar Presupuesto** ‚Üí Convertir presupuesto en venta
5. **Gestionar Venta** ‚Üí Seguimiento del proceso de venta

## üîå API Endpoints

### Clientes
```http
GET    /api/clientes              # Obtener todos los clientes
POST   /api/clientes              # Crear nuevo cliente
GET    /api/clientes/:id          # Obtener cliente por ID
PUT    /api/clientes/:id          # Actualizar cliente
DELETE /api/clientes/:id          # Eliminar cliente
```

### Presupuestos
```http
GET    /api/presupuestos                    # Obtener todos los presupuestos
POST   /api/presupuestos                    # Crear nuevo presupuesto
GET    /api/presupuestos/:id                # Obtener presupuesto por ID
PUT    /api/presupuestos/:id                # Actualizar presupuesto
DELETE /api/presupuestos/:id                # Eliminar presupuesto
GET    /api/presupuestos/cliente/:clienteId # Presupuestos de un cliente
POST   /api/presupuestos/:id/aprobar        # Aprobar presupuesto (crear venta)
```

### Ventas
```http
GET    /api/ventas                # Obtener todas las ventas
POST   /api/ventas                # Crear nueva venta
GET    /api/ventas/:id            # Obtener venta por ID
PUT    /api/ventas/:id            # Actualizar venta
DELETE /api/ventas/:id            # Eliminar venta
GET    /api/ventas/presupuesto/:presupuestoId  # Ventas de un presupuesto
```

### PDFs
```http
POST   /api/pdf/presupuesto       # Generar PDF de presupuesto
GET    /public/pdfs/:filename     # Descargar PDF generado
```

### Configuraci√≥n
```http
GET    /api/config                # Obtener configuraci√≥n (datos enmascarados)
PUT    /api/config                # Actualizar configuraci√≥n
POST   /api/config/test-email     # Probar configuraci√≥n de email
```

### Ejemplos de Uso de API

#### Crear Cliente
```javascript
const nuevoCliente = {
  nombre: "Juan P√©rez",
  email: "juan@email.com",
  telefono: "123456789",
  calle: "Av. Principal",
  numero: "123",
  ciudad: "Buenos Aires",
  provincia: "CABA",
  codigoPostal: "1000"
};

const response = await fetch('http://localhost:4000/api/clientes', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(nuevoCliente)
});
```

#### Crear Presupuesto
```javascript
const nuevoPresupuesto = {
  descripcion: "Cortina met√°lica para local comercial",
  valor: 15000.00,
  clienteId: 1,
  items: [
    {
      descripcion: "Cortina met√°lica 3x2m",
      cantidad: 1,
      precioUnitario: 12000.00
    },
    {
      descripcion: "Instalaci√≥n",
      cantidad: 1,
      precioUnitario: 3000.00
    }
  ]
};

const response = await fetch('http://localhost:4000/api/presupuestos', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(nuevoPresupuesto)
});
```

#### Generar PDF
```javascript
const pdfData = {
  presupuestoId: 1,
  template: "presupuesto_v1"
};

const response = await fetch('http://localhost:4000/api/pdf/presupuesto', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(pdfData)
});

const result = await response.json();
// result.pdfUrl contiene la URL del PDF generado
```

## üß© M√≥dulos del Sistema

### 1. M√≥dulo de Clientes (`/backend/src/modules/clientes/`)
- **Controller**: Manejo de requests HTTP
- **Service**: L√≥gica de negocio
- **Routes**: Definici√≥n de endpoints
- **Funcionalidades**: CRUD completo, validaciones, b√∫squedas

### 2. M√≥dulo de Presupuestos (`/backend/src/modules/presupuestos/`)
- **Gesti√≥n de cotizaciones** con items detallados
- **Vinculaci√≥n con clientes**
- **Estados**: pendiente, aprobado, rechazado
- **Conversi√≥n a ventas**

### 3. M√≥dulo de Ventas (`/backend/src/modules/ventas/`)
- **Registro de ventas** con items
- **Vinculaci√≥n con presupuestos**
- **Estados**: pendiente, completada, cancelada
- **Hook personalizado**: `useVentasFromPresupuestos`

### 4. M√≥dulo de PDFs (`/backend/src/modules/pdf/`)
- **Generaci√≥n con Puppeteer**
- **Templates personalizables** (Handlebars)
- **Estilos CSS** para documentos profesionales
- **Almacenamiento** en `/public/pdfs/`

### 5. M√≥dulo de Configuraci√≥n (`/backend/src/modules/configuracion/`)
- **Configuraci√≥n SMTP** para emails
- **Configuraci√≥n WhatsApp Business**
- **Cifrado AES-256-GCM** para datos sensibles
- **Singleton pattern** (una sola configuraci√≥n)

### 6. Sistema de Cifrado (`/backend/src/config/encryption.js`)
- **AES-256-GCM** para m√°xima seguridad
- **Claves de 32 bytes** (256 bits)
- **Vectores de inicializaci√≥n √∫nicos**
- **Funciones**: `encrypt()`, `decrypt()`

### 7. Middleware de Autenticaci√≥n (`/backend/src/middleware/auth.js`)
- **Preparado para JWT**
- **Validaci√≥n de tokens**
- **Protecci√≥n de rutas sensibles**

## üìÅ Estructura del Proyecto Detallada

### Frontend (`/frontend`)
```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ Navbar.jsx                    # Navegaci√≥n principal con enlaces
‚îÇ   ‚îú‚îÄ‚îÄ DashboardCard.jsx             # Tarjetas del dashboard
‚îÇ   ‚îú‚îÄ‚îÄ TablaVentas.jsx               # Tabla de ventas con filtros
‚îÇ   ‚îú‚îÄ‚îÄ FormularioPresupuesto.jsx     # Formulario de presupuestos
‚îÇ   ‚îî‚îÄ‚îÄ BotonAprobarPresupuesto.jsx   # Bot√≥n para aprobar presupuestos
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ Home.jsx                      # Dashboard con m√©tricas
‚îÇ   ‚îú‚îÄ‚îÄ Clientes.jsx                  # CRUD de clientes
‚îÇ   ‚îú‚îÄ‚îÄ Presupuestos.jsx              # Gesti√≥n de presupuestos
‚îÇ   ‚îî‚îÄ‚îÄ Ventas.jsx                    # Gesti√≥n de ventas
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îî‚îÄ‚îÄ useVentasFromPresupuestos.js  # Hook para ventas desde presupuestos
‚îú‚îÄ‚îÄ styles/                           # CSS Modules
‚îÇ   ‚îú‚îÄ‚îÄ global.css                    # Estilos globales
‚îÇ   ‚îú‚îÄ‚îÄ Navbar.module.css             # Estilos de navegaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ Home.module.css               # Estilos del dashboard
‚îÇ   ‚îú‚îÄ‚îÄ Clientes.module.css           # Estilos de clientes
‚îÇ   ‚îú‚îÄ‚îÄ Presupuestos.module.css       # Estilos de presupuestos
‚îÇ   ‚îú‚îÄ‚îÄ Ventas.module.css             # Estilos de ventas
‚îÇ   ‚îú‚îÄ‚îÄ TablaVentas.module.css        # Estilos de tabla de ventas
‚îÇ   ‚îú‚îÄ‚îÄ FormularioPresupuesto.module.css
‚îÇ   ‚îî‚îÄ‚îÄ BotonAprobarPresupuesto.module.css
‚îî‚îÄ‚îÄ main.jsx                          # Punto de entrada con React Router
```

### Backend (`/backend`)
```
src/
‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îú‚îÄ‚îÄ clientes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clientes.controller.js    # Controlador HTTP
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clientes.service.js       # L√≥gica de negocio
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ clientes.routes.js        # Rutas Express
‚îÇ   ‚îú‚îÄ‚îÄ presupuestos/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ presupuestos.controller.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ presupuestos.service.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ presupuestos.routes.js
‚îÇ   ‚îú‚îÄ‚îÄ ventas/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ventas.controller.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ventas.service.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ventas.routes.js
‚îÇ   ‚îú‚îÄ‚îÄ pdf/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pdf.controller.js         # Generaci√≥n de PDFs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pdf.service.js            # L√≥gica con Puppeteer
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pdf.routes.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ README.md                 # Documentaci√≥n del m√≥dulo
‚îÇ   ‚îî‚îÄ‚îÄ configuracion/
‚îÇ       ‚îú‚îÄ‚îÄ configuracion.controller.js
‚îÇ       ‚îú‚îÄ‚îÄ configuracion.service.js  # Cifrado/descifrado
‚îÇ       ‚îî‚îÄ‚îÄ configuracion.routes.js
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ db.js                         # Cliente Prisma
‚îÇ   ‚îî‚îÄ‚îÄ encryption.js                 # Sistema de cifrado AES-256-GCM
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îî‚îÄ‚îÄ auth.js                       # Middleware de autenticaci√≥n
‚îî‚îÄ‚îÄ server.js                         # Servidor Express principal
```

### Base de Datos (`/backend/prisma/`)
```
prisma/
‚îú‚îÄ‚îÄ schema.prisma                     # Modelo de datos completo
‚îú‚îÄ‚îÄ migrations/                       # Migraciones de base de datos
‚îÇ   ‚îú‚îÄ‚îÄ migration_lock.toml
‚îÇ   ‚îú‚îÄ‚îÄ 20250808234423_init/
‚îÇ   ‚îú‚îÄ‚îÄ 20250809001330_add_presupuestos/
‚îÇ   ‚îî‚îÄ‚îÄ 20250811145504_add_ventas_items/
‚îú‚îÄ‚îÄ seed.js                           # Datos de prueba
‚îú‚îÄ‚îÄ seed-presupuestos.js              # Seed espec√≠fico de presupuestos
‚îú‚îÄ‚îÄ seed-ventas.js                    # Seed espec√≠fico de ventas
‚îî‚îÄ‚îÄ dev.db                            # Base de datos SQLite
```

### Templates y Assets
```
backend/
‚îú‚îÄ‚îÄ templates/                        # Templates para PDFs
‚îÇ   ‚îú‚îÄ‚îÄ presupuesto_v1.html          # Template HTML
‚îÇ   ‚îî‚îÄ‚îÄ presupuesto_v1.css           # Estilos para PDF
‚îú‚îÄ‚îÄ public/pdfs/                      # PDFs generados
‚îú‚îÄ‚îÄ test-pdf.js                       # Script de prueba de PDFs
‚îî‚îÄ‚îÄ ejemplos-api-pdf.md               # Documentaci√≥n de API PDF

frontend/assets/                      # Assets del frontend
‚îú‚îÄ‚îÄ logo.pdf
‚îî‚îÄ‚îÄ presupuesto.pdf
```

## üîß Desarrollo

### Comandos √ötiles

#### Backend
```bash
cd backend

# Desarrollo
npm run dev              # Servidor con nodemon
npm start               # Servidor de producci√≥n

# Base de datos
npx prisma generate     # Generar cliente Prisma
npx prisma migrate dev  # Ejecutar migraciones
npm run seed           # Poblar base de datos
npx prisma studio      # Interfaz gr√°fica de BD

# Utilidades
node test-pdf.js       # Probar generaci√≥n de PDFs
```

#### Frontend
```bash
cd frontend

# Desarrollo
npm run dev            # Servidor de desarrollo (Vite)
npm run build          # Construir para producci√≥n
npm run preview        # Vista previa de producci√≥n
```

#### Docker
```bash
# Desarrollo completo
docker-compose up --build

# Solo base de datos
docker-compose up postgres

# Ver logs
docker-compose logs -f backend
docker-compose logs -f frontend

# Limpiar
docker-compose down -v
```

### Flujo de Desarrollo

1. **Crear rama de feature**
   ```bash
   git checkout -b feature/nueva-funcionalidad
   ```

2. **Desarrollar y probar**
   ```bash
   # Terminal 1: Backend
   cd backend && npm run dev
   
   # Terminal 2: Frontend
   cd frontend && npm run dev
   
   # Terminal 3: Base de datos (si es necesario)
   docker-compose up postgres
   ```

3. **Probar funcionalidades**
   ```bash
   # Probar PDFs
   cd backend && node test-pdf.js
   
   # Probar API
   curl http://localhost:4000/api/clientes
   ```

4. **Commit y push**
   ```bash
   git add .
   git commit -m "feat: agregar nueva funcionalidad"
   git push origin feature/nueva-funcionalidad
   ```

### Est√°ndares de C√≥digo

- **ES Modules**: Uso de `import/export` en lugar de `require`
- **Async/Await**: Para operaciones as√≠ncronas
- **Error Handling**: Try-catch en todos los controladores
- **Validaci√≥n**: Validaci√≥n de datos en servicios
- **CSS Modules**: Estilos encapsulados en frontend
- **Conventional Commits**: Formato est√°ndar de commits

### Debugging

#### Backend
```bash
# Logs detallados
DEBUG=* npm run dev

# Inspeccionar base de datos
npx prisma studio

# Probar endpoints
curl -X GET http://localhost:4000/api/clientes
curl -X POST http://localhost:4000/api/clientes \
  -H "Content-Type: application/json" \
  -d '{"nombre":"Test","email":"test@test.com"}'
```

#### Frontend
```bash
# Modo desarrollo con hot reload
npm run dev

# Build para verificar errores
npm run build
```

## üöÄ Despliegue

### Con Docker Compose (Recomendado)

#### Producci√≥n
```bash
# Crear docker-compose.prod.yml
version: '3.8'
services:
  postgres:
    image: postgres:16
    environment:
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      POSTGRES_DB: ${DB_NAME}
    volumes:
      - pgdata:/var/lib/postgresql/data

  backend:
    build: 
      context: ./backend
      dockerfile: Dockerfile.prod
    environment:
      NODE_ENV: production
      DATABASE_URL: postgresql://${DB_USER}:${DB_PASSWORD}@postgres:5432/${DB_NAME}
    depends_on:
      - postgres

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.prod
    depends_on:
      - backend

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - frontend
      - backend

volumes:
  pgdata:
```

```bash
# Desplegar
docker-compose -f docker-compose.prod.yml up -d
```

### Despliegue Manual

#### Backend
```bash
cd backend

# Instalar dependencias de producci√≥n
npm ci --only=production

# Generar cliente Prisma
npx prisma generate

# Ejecutar migraciones
npx prisma migrate deploy

# Iniciar aplicaci√≥n
NODE_ENV=production npm start
```

#### Frontend
```bash
cd frontend

# Instalar dependencias
npm ci

# Construir aplicaci√≥n
npm run build

# Servir con nginx o servidor est√°tico
# Los archivos est√°n en dist/
```

### Variables de Entorno para Producci√≥n

```env
# Backend (.env)
NODE_ENV=production
DATABASE_URL=postgresql://user:pass@prod-db:5432/erp_cortinas
PORT=4000

# Claves de cifrado (generar nuevas para producci√≥n)
CONFIG_SECRETS_KEY=nueva_clave_base64_32_bytes
ADMIN_KEY=nueva_clave_hex_64_caracteres

# CORS
FRONTEND_URL=https://tu-dominio.com

# Email (opcional)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=tu-email@gmail.com
SMTP_PASS=tu-password-app
```

### Configuraci√≥n Nginx

```nginx
# nginx.conf
server {
    listen 80;
    server_name tu-dominio.com;

    # Frontend
    location / {
        root /var/www/html;
        try_files $uri $uri/ /index.html;
    }

    # Backend API
    location /api/ {
        proxy_pass http://backend:4000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # PDFs est√°ticos
    location /public/ {
        proxy_pass http://backend:4000;
    }
}
```

## üîí Seguridad

### Medidas Implementadas

#### Cifrado de Datos
- **AES-256-GCM** para datos sensibles
- **Claves de 32 bytes** generadas criptogr√°ficamente
- **Vectores de inicializaci√≥n √∫nicos** por operaci√≥n
- **Campos enmascarados** en respuestas API

#### Validaci√≥n y Sanitizaci√≥n
- **Prisma ORM** previene inyecci√≥n SQL
- **Validaci√≥n de tipos** en controladores
- **CORS** configurado correctamente
- **Variables de entorno** para datos sensibles

#### Autenticaci√≥n y Autorizaci√≥n
- **Middleware de autenticaci√≥n** preparado
- **Sistema de tokens JWT** (preparado para implementar)
- **Protecci√≥n de rutas** sensibles

### Recomendaciones de Seguridad

#### Para Producci√≥n
- Usar **HTTPS** obligatoriamente
- Implementar **rate limiting**
- Configurar **firewall** adecuadamente
- Mantener **dependencias actualizadas**
- **Rotar claves** criptogr√°ficas peri√≥dicamente
- **Auditor√≠as de seguridad** regulares

#### Gesti√≥n de Claves
```bash
# Generar nuevas claves para producci√≥n
python3 generate-keys.py

# Nunca commitear claves reales
echo "*.env" >> .gitignore
echo "generate-keys.py" >> .gitignore
```

## ü§ù Contribuci√≥n

### C√≥mo Contribuir

1. **Fork** el repositorio
2. **Crear** rama de feature (`git checkout -b feature/AmazingFeature`)
3. **Commit** cambios (`git commit -m 'feat: Add some AmazingFeature'`)
4. **Push** a la rama (`git push origin feature/AmazingFeature`)
5. **Abrir** Pull Request

### Est√°ndares de Contribuci√≥n

#### Commits
- Usar **Conventional Commits**: `feat:`, `fix:`, `docs:`, `style:`, `refactor:`, `test:`
- **Mensajes descriptivos** en espa√±ol
- **Un commit por funcionalidad**

#### C√≥digo
- **ESLint** para JavaScript
- **Prettier** para formateo
- **Comentarios** en espa√±ol
- **Tests** para nuevas funcionalidades

#### Pull Requests
- **Descripci√≥n clara** del cambio
- **Screenshots** si afecta UI
- **Tests** pasando
- **Documentaci√≥n** actualizada

### Reportar Bugs

Usar el sistema de issues de GitHub con:
- **Descripci√≥n clara** del problema
- **Pasos para reproducir**
- **Comportamiento esperado** vs actual
- **Screenshots** si aplica
- **Informaci√≥n del entorno**

### Solicitar Funcionalidades

- **Descripci√≥n detallada** de la funcionalidad
- **Casos de uso** espec√≠ficos
- **Mockups** o wireframes si aplica
- **Justificaci√≥n** del valor agregado

## üìä Monitoreo y Logs

### Logs de Aplicaci√≥n

#### Desarrollo
```bash
# Backend logs
cd backend && npm run dev

# Frontend logs
cd frontend && npm run dev

# Docker logs
docker-compose logs -f backend
docker-compose logs -f frontend
```

#### Producci√≥n
```bash
# Logs en tiempo real
docker-compose logs -f --tail=100 backend

# Logs espec√≠ficos por fecha
docker-compose logs --since="2024-01-01" backend

# Exportar logs
docker-compose logs backend > backend.log
```

### M√©tricas de Rendimiento

#### Backend
- **Tiempo de respuesta** de APIs
- **Uso de memoria** y CPU
- **Conexiones** de base de datos
- **Errores** de aplicaci√≥n
- **Generaci√≥n de PDFs** (tiempo)

#### Frontend
- **Tiempo de carga** inicial
- **Interacciones** de usuario
- **Errores** de JavaScript
- **Rendimiento** de componentes

### Herramientas de Monitoreo

#### Recomendadas
- **PM2** para gesti√≥n de procesos Node.js
- **Nginx** logs para proxy reverso
- **PostgreSQL** logs para base de datos
- **Grafana** + **Prometheus** para m√©tricas
- **Sentry** para tracking de errores

## üß™ Testing

### Estructura de Tests

```
backend/
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ unit/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ integration/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ e2e/
‚îÇ       ‚îî‚îÄ‚îÄ workflows/

frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ __tests__/
‚îÇ       ‚îú‚îÄ‚îÄ components/
‚îÇ       ‚îú‚îÄ‚îÄ pages/
‚îÇ       ‚îî‚îÄ‚îÄ hooks/
```

### Backend Testing

```bash
cd backend

# Tests unitarios
npm test

# Tests con cobertura
npm run test:coverage

# Tests de integraci√≥n
npm run test:integration

# Tests E2E
npm run test:e2e
```

### Frontend Testing

```bash
cd frontend

# Tests unitarios (Jest + React Testing Library)
npm test

# Tests E2E (Cypress)
npm run test:e2e

# Tests de componentes (Storybook)
npm run storybook
```

### Ejemplos de Tests

#### Backend - Test de Servicio
```javascript
// tests/unit/services/clientes.service.test.js
import { describe, it, expect } from 'vitest';
import { ClientesService } from '../../../src/modules/clientes/clientes.service.js';

describe('ClientesService', () => {
  it('should create a new client', async () => {
    const clienteData = {
      nombre: 'Test Cliente',
      email: 'test@test.com'
    };
    
    const result = await ClientesService.create(clienteData);
    
    expect(result).toHaveProperty('id');
    expect(result.nombre).toBe(clienteData.nombre);
  });
});
```

#### Frontend - Test de Componente
```javascript
// src/__tests__/components/Navbar.test.jsx
import { render, screen } from '@testing-library/react';
import { BrowserRouter } from 'react-router-dom';
import Navbar from '../../components/Navbar';

test('renders navigation links', () => {
  render(
    <BrowserRouter>
      <Navbar />
    </BrowserRouter>
  );
  
  expect(screen.getByText('Clientes')).toBeInTheDocument();
  expect(screen.getByText('Presupuestos')).toBeInTheDocument();
  expect(screen.getByText('Ventas')).toBeInTheDocument();
});
```

## üìà Roadmap

### Versi√≥n 1.1 (Pr√≥xima)
- [ ] **Sistema de autenticaci√≥n completo** con JWT
- [ ] **M√≥dulo de reportes avanzados** con gr√°ficos
- [ ] **Integraci√≥n con APIs de facturaci√≥n** (AFIP)
- [ ] **Notificaciones en tiempo real** con WebSockets
- [ ] **Backup autom√°tico** de base de datos
- [ ] **Logs estructurados** con Winston

### Versi√≥n 1.2 (Futuro)
- [ ] **Aplicaci√≥n m√≥vil** (React Native)
- [ ] **Integraci√≥n con sistemas contables**
- [ ] **Dashboard analytics avanzado** con BI
- [ ] **API GraphQL** como alternativa
- [ ] **Microservicios** para escalabilidad
- [ ] **Integraci√≥n con WhatsApp Business API**

### Versi√≥n 2.0 (Visi√≥n)
- [ ] **Multi-tenancy** para m√∫ltiples empresas
- [ ] **Marketplace** de plugins
- [ ] **IA para predicciones** de ventas
- [ ] **Integraci√≥n con IoT** para cortinas inteligentes
- [ ] **Blockchain** para trazabilidad
- [ ] **PWA** con funcionalidades offline

## üìÑ Licencia

Este proyecto est√° bajo la **Licencia MIT**. Ver `LICENSE` para m√°s detalles.

```
MIT License

Copyright (c) 2024 Lean Ramirez

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.
```

## üë• Equipo

### Desarrolladores
- **Lean Ramirez** - Desarrollador Principal - [@LeanRamirez](https://github.com/LeanRamirez)

### Contribuidores
- Ver [Contributors](https://github.com/LeanRamirez/ERP-Cortinas-Aymara/contributors)

### Agradecimientos
- Comunidad de **React** y **Node.js**
- Equipo de **Prisma** por el excelente ORM
- **Puppeteer** team por la generaci√≥n de PDFs
- Contribuidores de **open source**

## üìû Soporte

### Canales de Comunicaci√≥n
- **Email**: soporte@erp-cortinas.com
- **Issues**: [GitHub Issues](https://github.com/LeanRamirez/ERP-Cortinas-Aymara/issues)
- **Documentaci√≥n**: [Wiki del Proyecto](https://github.com/LeanRamirez/ERP-Cortinas-Aymara/wiki)
- **Discussions**: [GitHub Discussions](https://github.com/LeanRamirez/ERP-Cortinas-Aymara/discussions)

### FAQ (Preguntas Frecuentes)

#### ¬øC√≥mo cambio de SQLite a PostgreSQL?
```env
# En .env cambiar:
DATABASE_URL="postgresql://user:password@localhost:5432/erp_cortinas"
```

#### ¬øC√≥mo genero nuevas claves de cifrado?
```bash
python3 generate-keys.py
# Copiar las claves al archivo .env
```

#### ¬øC√≥mo reseteo la base de datos?
```bash
cd backend
npx prisma migrate reset
npm run seed
```

#### ¬øC√≥mo agrego un nuevo m√≥dulo?
1. Crear carpeta en `/backend/src/modules/nuevo-modulo/`
2. Crear `controller.js`, `service.js`, `routes.js`
3. Agregar ruta en `server.js`
4. Actualizar esquema Prisma si es necesario

## üîÑ Changelog

### [1.0.0] - 2024-08-23
#### Agregado
- ‚úÖ Sistema completo de gesti√≥n de clientes
- ‚úÖ M√≥dulo de presupuestos con items
- ‚úÖ M√≥dulo de ventas vinculado a presupuestos
- ‚úÖ Generaci√≥n de PDFs con Puppeteer
- ‚úÖ Sistema de cifrado AES-256-GCM
- ‚úÖ Configuraci√≥n empresarial segura
- ‚úÖ API RESTful completa
- ‚úÖ Frontend React con CSS Modules
- ‚úÖ Dockerizaci√≥n completa
- ‚úÖ Base de datos con Prisma ORM

#### T√©cnico
- ‚úÖ ES Modules en backend
- ‚úÖ Arquitectura modular
- ‚úÖ Middleware de autenticaci√≥n preparado
- ‚úÖ Sistema de migraciones
- ‚úÖ Scripts de seed para datos de prueba

## üéØ Estado del Proyecto

### ‚úÖ Completado
- [x] **Gesti√≥n de Clientes** - CRUD completo
- [x] **Presupuestos** - Creaci√≥n, edici√≥n, items
- [x] **Ventas** - Registro y vinculaci√≥n
- [x] **PDFs** - Generaci√≥n profesional
- [x] **Cifrado** - Datos sensibles protegidos
- [x] **API** - Endpoints RESTful
- [x] **Frontend** - Interfaz React moderna
- [x] **Docker** - Contenedorizaci√≥n
- [x] **Base de Datos** - Modelo relacional

### üöß En Desarrollo
- [ ] **Autenticaci√≥n JWT** - Sistema completo
- [ ] **Reportes** - Dashboard analytics
- [ ] **Tests** - Cobertura completa
- [ ] **Documentaci√≥n API** - Swagger/OpenAPI

### üìã Pendiente
- [ ] **Notificaciones** - Email y WhatsApp
- [ ] **Backup** - Sistema autom√°tico
- [ ] **Logs** - Sistema estructurado
- [ ] **Monitoreo** - M√©tricas de rendimiento

## üåü Caracter√≠sticas Destacadas

### üîê Seguridad Avanzada
- **Cifrado AES-256-GCM** para datos sensibles
- **Claves criptogr√°ficas** de 32 bytes
- **Variables de entorno** para configuraci√≥n
- **Prisma ORM** previene inyecci√≥n SQL

### üìä Gesti√≥n Completa
- **Flujo completo**: Cliente ‚Üí Presupuesto ‚Üí Venta
- **PDFs profesionales** con templates personalizables
- **Vinculaci√≥n de datos** entre m√≥dulos
- **Estados de seguimiento** para procesos

### üöÄ Tecnolog√≠a Moderna
- **React 18** con hooks y CSS Modules
- **Node.js** con ES Modules
- **Prisma** como ORM moderno
- **Docker** para despliegue f√°cil

### üé® Experiencia de Usuario
- **Interfaz intuitiva** y responsive
- **Navegaci√≥n fluida** entre m√≥dulos
- **Formularios validados** y user-friendly
- **Feedback visual** en todas las acciones

---

## üìã Resumen Ejecutivo

**ERP Cortinas Aymara** es un sistema de gesti√≥n empresarial completo y moderno, espec√≠ficamente dise√±ado para empresas del sector de cortinas met√°licas. 

### üéØ Prop√≥sito
Digitalizar y optimizar los procesos de negocio desde la gesti√≥n de clientes hasta la generaci√≥n de ventas, pasando por presupuestos profesionales en PDF.

### üí° Valor Agregado
- **Eficiencia**: Automatizaci√≥n de procesos manuales
- **Profesionalismo**: Documentos PDF de alta calidad
- **Seguridad**: Protecci√≥n de datos sensibles
- **Escalabilidad**: Arquitectura preparada para crecimiento
- **Modernidad**: Tecnolog√≠as actuales y mejores pr√°cticas

### üöÄ Implementaci√≥n
Sistema listo para producci√≥n con:
- **Instalaci√≥n r√°pida** con Docker
- **Configuraci√≥n flexible** para diferentes entornos
- **Documentaci√≥n completa** para desarrolladores
- **Soporte t√©cnico** disponible

---

**¬°ERP Cortinas Aymara est√° listo para transformar tu negocio! üöÄ**

*√öltima actualizaci√≥n: 23 de Agosto, 2025*
*Versi√≥n: 1.0.0*
*Estado: Producci√≥n Ready ‚úÖ*
